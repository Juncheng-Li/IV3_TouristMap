<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8"/>
    <title>Display driving directions</title>
    <meta name="viewport" content="initial-scale=1,maximum-scale=1,user-scalable=no"/>
    <script src="https://api.mapbox.com/mapbox-gl-js/v1.12.0/mapbox-gl.js"></script>
    <link href="https://api.mapbox.com/mapbox-gl-js/v1.12.0/mapbox-gl.css" rel="stylesheet"/>
    <link href="style.css" rel="stylesheet">
</head>
<body>
<script src="https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-directions/v4.1.0/mapbox-gl-directions.js"></script>
<link
        rel="stylesheet"
        href="https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-directions/v4.1.0/mapbox-gl-directions.css"
        type="text/css"
/>
<div id="map"></div>

<script>
    mapboxgl.accessToken = 'pk.eyJ1IjoieXVubmluZ2ciLCJhIjoiY2tldjl0ZmZoMjRoajJxcXYzNGU1M2p0aCJ9.30fp6J7Abr9VbS_ev_jYpA';
    var map = new mapboxgl.Map({
        container: 'map',
        style: 'mapbox://styles/mapbox/streets-v11',
        center: [144.96, -37.81],
        zoom: 13
    });

    // map.addSource('urban-areas', {
    //     'type': 'geojson',
    //     'data': 'mapbox://yunningg.d15riytj'
    // });

    map.on('load', function () {
        const images = [
            {imageUrl: './images/icon/museum.png', id: 'museum'},
            {imageUrl: './images/icon/church.png', id: 'church'},
            {imageUrl: './images/icon/outdoor.png', id: 'outdoor'},
            {imageUrl: './images/poi/MC.jpeg', id: 'MC'},
            {imageUrl: './images/poi/result.png', id: 'result'},
            {imageUrl: './images/poi/mask.png', id: 'mask'},
        ];
        images.forEach(img => {
            map.loadImage(img.imageUrl, function (error, res) {
                map.addImage(img.id, res)
            })
        });

        map.addSource('poi', {
            type: 'vector',
            url: 'mapbox://yunningg.d15riytj'
        });

        map.addLayer({
            id: 'museum points',
            type: 'symbol',
            maxzoom: 14,
            source: 'poi',
            layout: {
                'visibility': 'visible',
                // 'icon-image': 'museum',
                'icon-image': {
                    property: 'Sub_Theme',
                    type: 'categorical',
                    stops: [
                        ['Art Gallery/Museum', 'museum'],
                        ['Church', 'church'],
                        ['Informal Outdoor Facility (Park/Garden/Reserve)', 'outdoor'],
                    ]
                },
                'icon-size': 0.08,
                'icon-allow-overlap': true
            },
            'source-layer': 'Melbourne_POIs_MGA-0lenk4', // the name of your new point layer (see tileset)
        });

    });

    // map.addControl(
    //     new MapboxDirections({
    //         accessToken: mapboxgl.accessToken
    //     }),
    //     'top-left'
    // );

    var MelbourneCentral = [144.9628, -37.8102];

    // create the popup
    var popupArr = [];
    var popup = new mapboxgl.Popup({offset: 25}).setText('Construction on the Washington Monument began in 1848.');

    // create DOM element for the marker
    var elementArr = [];
    var el = document.createElement('div');
    el.className = 'marker';
    el.hidden = true;

    // create the marker
    new mapboxgl.Marker(el)
        .setLngLat(MelbourneCentral)
        .setPopup(popup) // sets a popup on this marker
        .addTo(map);

    map.on('zoom', function () {
        if (map.getZoom() <= 16) {
            el.hidden = true;
        } else {
            el.hidden = false;
        }
    });
</script>

</body>
</html>