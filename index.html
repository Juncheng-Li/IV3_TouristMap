<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8"/>
    <title>Display driving directions</title>
    <meta name="viewport" content="initial-scale=1,maximum-scale=1,user-scalable=no"/>
    <script src="https://api.mapbox.com/mapbox-gl-js/v1.12.0/mapbox-gl.js"></script>
    <link href="https://api.mapbox.com/mapbox-gl-js/v1.12.0/mapbox-gl.css" rel="stylesheet"/>
    <link href="style.css" rel="stylesheet">
</head>
<body>
<script src="https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-directions/v4.1.0/mapbox-gl-directions.js"></script>
<script src="./stopSetting.js"></script>
<script src="./imagesLoad.js"></script>

<link
        rel="stylesheet"
        href="https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-directions/v4.1.0/mapbox-gl-directions.css"
        type="text/css"
/>
<div>
    <div id="map"></div>
    <div class="map-overlay" id="detailPanel">
        <button id="close-btn">x</button>
        <div>
            <h3 id="detailTitle">Title</h3>
            <h4 id="subtitle">subtitle</h4>
        </div>
        <div id="place">
            <img id="placeImage" src="./images/poi/Melbourne%20Central.jpg" alt="poi">
        </div>

        <div>
            <p class="Description">
                <img src="images/other/location.png" alt="" style="width: 15px; height: 15px; margin-right: 8px">
                Address: 100 Swanston St, Melbourne 3000
            </p>
            <p class="Description">
                <img src="images/other/clock3.png" alt="" style="width: 15px; height: 15px; margin-right: 8px">
                Open hours: 10:00 - 18:00
            </p>
        </div>
        <div class="advanceInfo">
            <p class="infoButton ">
                <button class="filters" id="park-btn"
                        style="background-image: url(./images/other/icons8-parking-96.png)"></button>
                <button class="filters" id="bike-btn" style="background-image: url(./images/other/bike.png)"></button>
                <button class="filters" id="ptv-btn" style="background-image: url(./images/other/ptv.jpeg)"></button>
            </p>
        </div>
    </div>
    <div class="layerFilterPanel" id="layerFilterPanel">
        <nav id="layerFilterList">
            <a href="#" class="layerFilterBtn" id="museum-btn" style="background-image: url(./images/icon/museum.png) ">Museum</a>
            <a href="#" class="layerFilterBtn" id="church-btn" style="background-image: url(./images/icon/church.png) ">Church</a>
            <a href="#" class="layerFilterBtn" id="shop-btn" style="background-image: url(./images/icon/shop.png) ">Shopping</a>
            <a href="#" class="layerFilterBtn" id="nature-btn" style="background-image: url(./images/icon/nature.png) ">Park</a>
            <a href="#" class="layerFilterBtn" id="theatre-btn" style="background-image: url(./images/icon/theatre.png) ">Theatre</a>
            <a href="#" class="layerFilterBtn" id="harbor-btn" style="background-image: url(images/icon/harbor.png) ">Harbor</a>
            <a href="#" class="layerFilterBtn" id="indoor-btn" style="background-image: url(./images/icon/indoor.png) ">Indoor</a>
            <a href="#" class="layerFilterBtn" id="building-btn" style="background-image: url(./images/icon/building.png) ">Building</a>
            <a href="#" class="layerFilterBtn" id="sport-btn" style="background-image: url(./images/icon/sport.png) ">Sport</a>
        </nav>
        <a href="#" id="filter-btn">SELECT WHAT TO SEE  â¬†</a>
    </div>
</div>


<script>
    mapboxgl.accessToken = 'pk.eyJ1IjoieXVubmluZ2ciLCJhIjoiY2tldjl0ZmZoMjRoajJxcXYzNGU1M2p0aCJ9.30fp6J7Abr9VbS_ev_jYpA';
    var map = new mapboxgl.Map({
        container: 'map',
        style: 'mapbox://styles/mapbox/streets-v11',
        center: [144.96, -37.81],
        zoom: 14
    });

    var detailPanel = document.getElementById("detailPanel");
    detailPanel.hidden = true;


    var parkBtn = document.getElementById("park-btn");
    parkBtn.addEventListener('click', () => {
        console.log("park!!!");
    });
    var ptvBtn = document.getElementById("ptv-btn");
    ptvBtn.addEventListener('click', () => {
        console.log("ptv!!!");
    });
    var bikeBtn = document.getElementById("bike-btn");
    bikeBtn.addEventListener('click', () => {
        console.log("bike!!!");
    });
    var closeBtn = document.getElementById("close-btn");
    closeBtn.addEventListener('click', () => {
        // console.log("close!!!");
        detailPanel.hidden = true;
    });

    var museumBtn = document.getElementById("museum-btn");
    var churchBtn = document.getElementById("church-btn");
    var shopBtn = document.getElementById("shop-btn");
    var natureBtn = document.getElementById("nature-btn");
    var theatreBtn = document.getElementById("theatre-btn");
    var harborBtn = document.getElementById("harbor-btn");
    var indoorBtn = document.getElementById("indoor-btn");
    var sportBtn = document.getElementById("sport-btn");
    var buildingBtn = document.getElementById("building-btn");

    var layerFilterList = document.getElementById("layerFilterList");
    var filterBtn = document.getElementById("filter-btn");
    filterBtn.onclick = function (e) {
        if (layerFilterList.style.display === "none"){
            layerFilterList.style.display = "block";
        }else {
            layerFilterList.style.display = "none";
        }
    };

    var classifications = ['museum', 'church', 'shop', 'nature','theatre','harbor','indoor','sport','building'];

    map.on('load', function () {
        const images = imagesAll;
        images.forEach(img => {
            map.loadImage(img.imageUrl, function (error, res) {
                map.addImage(img.id, res)
            })
        });

        map.addSource('poi', {
            type: 'vector',
            url: 'mapbox://yunningg.d15riytj'
        });

        var classifications = ['museum', 'church', 'shop', 'nature','theatre','harbor','indoor','sport','building'];

        classifications.forEach(classification => {
            var layerID = 'poi-' + classification;

            console.log(classification)

            if (!map.getLayer(layerID)) {
                map.addLayer({
                    id: layerID,
                    type: 'symbol',
                    source: 'poi',
                    layout: {
                        'visibility': 'visible',
                        'icon-image':classification,
                        'icon-size': 0.18,
                        'icon-allow-overlap': true
                    },
                    filter: ['in', 'Sub_Theme'].concat(getFilterParameter(layerID)),
                    'source-layer': 'Melbourne_POIs_MGA-0lenk4', // the name of your new point layer (see tileset)
                });

                map.on('click', layerID, function (e) {
                    showDetailPanel(e.features[0]);
                });

                var buttonName = getButtonName(layerID)

                eval(buttonName).onclick = function (e) {
                    e.preventDefault();
                    e.stopPropagation();

                    let visibility = map.getLayoutProperty(layerID, 'visibility');

                    if (visibility !== 'none') {
                        map.setLayoutProperty(layerID, 'visibility', 'none');
                        this.className = 'disable';
                    } else {
                        this.className = 'active';
                        map.setLayoutProperty(layerID, 'visibility', 'visible');
                    }
                };
            }
        });

    });

    map.addControl(new mapboxgl.NavigationControl(), "top-right");

    // map.addControl(
    //     new MapboxDirections({
    //         accessToken: mapboxgl.accessToken
    //     }),
    //     'top-left'
    // );

    map.on('zoom', function () {
        if (map.getZoom() <= 15.9){
            classifications.forEach(classification => {
                var layerID = 'poi-' + classification;
                map.setLayoutProperty(layerID, 'icon-image', classification);
                map.setLayoutProperty(layerID, 'icon-size', 0.18);
            });

        }else{
            classifications.forEach(classification => {
                var layerID = 'poi-' + classification;
                map.setLayoutProperty(
                    layerID,
                    'icon-image', {
                        property: 'Feature_Na',
                        type: 'categorical',
                        stops: stopsAll
                    });
                map.setLayoutProperty(layerID, 'icon-size', 0.3);
            });
        }
    });

    function showDetailPanel(poi) {
        //set detail panel title
        var detailTitle = document.getElementById("detailTitle");
        detailTitle.innerHTML = '<h2>' + poi.properties.Feature_Na + '</h2>';
        //set subtitle
        var detailSubtitle = document.getElementById("subtitle");
        detailSubtitle.innerHTML = '<h4>' + poi.properties.Sub_Theme + '</h4>';
        //set detail panel image
        var placeImg = document.getElementById("place");
        placeImg.innerHTML = "<img id = \"placeImage\" src=\"./images/poi/" + poi.properties.Feature_Na + ".jpg\" alt=\"poi\">";
        detailPanel.hidden = false;
    }

    function getFilterParameter(layerID){
        var filter

        if (layerID === 'poi-museum') {
            filter = ['Art Gallery/Museum', 'Aquarium','Library']

        } else if (layerID === 'poi-church') {
            filter = ['Church', 'Synagogue']

        } else if (layerID === 'poi-shop') {
            filter = ['Department Store', 'Retail','Retail/Office','Retail/Office/Carpark',
                'Retail/Office/Residential/Carpark','Retail/Residential','Store Yard']

        } else if (layerID === 'poi-nature') {
            filter = ['Informal Outdoor Facility (Park/Garden/Reserve)', 'Outdoor Recreation Facility (Zoo, Golf Course)']

        } else if (layerID === 'poi-theatre') {
            filter = ['Theatre Live']

        } else if (layerID === 'poi-harbor') {
            filter = ['Marina', 'Transport Terminal']

        } else if (layerID === 'poi-indoor') {
            filter = ['Indoor Recreation Facility', 'Cinema']

        } else if (layerID === 'poi-building') {
            filter = ['Function/Conference/Exhibition Centre', 'Observation Tower/Wheel','Public Buildings',
                'Visitor Centre']

        } else if (layerID === 'poi-sport') {
            filter = ['Gymnasium/Health Club', 'Major Sports & Recreation Facility']

        }
        return filter;
    }

    function getButtonName(layerID){
        var buttonName

        if (layerID === 'poi-museum') {
            buttonName = 'museumBtn'

        } else if (layerID === 'poi-church') {
            buttonName = 'churchBtn'

        } else if (layerID === 'poi-shop') {
            buttonName = 'shopBtn'

        } else if (layerID === 'poi-nature') {
            buttonName = 'natureBtn'

        } else if (layerID === 'poi-theatre') {
            buttonName = 'theatreBtn'

        } else if (layerID === 'poi-harbor') {
            buttonName = 'harborBtn'

        } else if (layerID === 'poi-indoor') {
            buttonName = 'indoorBtn'

        } else if (layerID === 'poi-building') {
            buttonName = 'buildingBtn'

        } else if (layerID === 'poi-sport') {
            buttonName = 'sportBtn'

        }
        return buttonName;
    }
</script>

</body>
</html>